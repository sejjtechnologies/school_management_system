<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create User</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f5f7fa; /* light neutral background like register page */
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .navbar {
      background-color: #4CAF50; /* match register green */
      height: 60px;
    }
    .navbar-brand, .nav-link { color: #fff !important; }
    .back-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .back-btn:hover { background-color: #c82333; }

    /* Content area that scrolls between fixed navbar and footer */
    .content {
      flex: 1;
      overflow-y: auto;
      margin-top: 70px; /* below navbar */
      padding: 18px;
      padding-bottom: 160px; /* ensure space above footer */
    }

    /* Grouped sections like register page */
    .section {
      padding: 14px;
      border-radius: 8px;
      margin-bottom: 18px;
      background-color: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    .section h3 { margin: 0 0 10px 0; font-size: 1.05rem; }
    .form-row { display: flex; flex-wrap: wrap; gap: 10px; }
    .form-row > div { flex: 1; min-width: 120px; }

    label { font-weight: 600; font-size: 0.95rem; }
    .input-group-text { background-color: #f1f1f1; border: none; }
    .form-control { font-size: 0.95rem; padding: 8px 10px; }

    .submit-btn { margin-top: 8px; padding: 12px; border-radius: 25px; font-weight: 700; }

    footer { position: fixed; bottom: 0; width: 100%; background-color: #eee; text-align: center; padding: 10px; }

    @media (max-width: 576px) {
      .back-btn { padding: 6px 10px; font-size: 13px; }
      .form-control { font-size: 0.9rem; }
      .content { padding: 12px; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar fixed-top navbar-expand-lg">
    <div class="container-fluid px-3">
      <a class="navbar-brand fw-bold" href="#"><i class="bi bi-person-plus-fill me-2"></i>Create User</a>
      <div class="ms-auto">
        <!-- ✅ Back button now links to admin dashboard safely -->
        <a href="{{ url_for('user_routes.admin_dashboard') }}" class="btn back-btn">
          <i class="bi bi-box-arrow-left me-1"></i>Back
        </a>
      </div>
    </div>
  </nav>
    <!-- Main Content -->
    <div class="content">
      <main class="container my-2">
        <div class="row justify-content-center">
          <div class="col-12 col-md-9 col-lg-7">

        <!-- ✅ Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="post">
          <div class="section">
            <h3><i class="bi bi-person-circle me-2"></i>Personal Information</h3>
            <div class="form-row">
              <div>
                <label for="first_name">First name</label>
                <input type="text" id="first_name" name="first_name" class="form-control" value="{{ first_name or '' }}" required>
              </div>
              <div>
                <label for="last_name">Last name</label>
                <input type="text" id="last_name" name="last_name" class="form-control" value="{{ last_name or '' }}" required>
              </div>
            </div>
            <div class="form-row mt-3">
              <div>
                <label for="email">Email</label>
                <input type="email" id="email" name="email" class="form-control" value="{{ email or '' }}" required>
              </div>
              <div>
                <label for="role">Role</label>
                <select id="role" name="role" class="form-select" required>
                  <option value="" disabled selected>Select Role</option>
                  {% for role in roles %}
                  <option value="{{ role.role_name }}">{{ role.role_name }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>

          <div class="section">
            <h3><i class="bi bi-shield-lock me-2"></i>Credentials</h3>
            <div class="form-row">
              <div>
                <label for="password">Password</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-lock"></i></span>
                  <input type="password" class="form-control" id="password" name="password" required />
                  <button type="button" class="btn eye-toggle-wrapper" onclick="togglePassword()" aria-label="Toggle password visibility">
                    <i id="eyeToggle" class="bi bi-eye-slash eye-toggle-icon"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-success submit-btn">
              <i class="bi bi-person-check-fill me-2"></i>Create User
            </button>
          </div>
        </form>
      </div>
    </div>
    </main>
  </div>

  {% include 'footer.html' %}

  <script>
    function togglePassword() {
      const input = document.getElementById("password");
      const icon = document.getElementById("eyeToggle");
      if (!input || !icon) return;
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("bi-eye-slash");
        icon.classList.add("bi-eye", "visible");
      } else {
        input.type = "password";
        icon.classList.remove("bi-eye", "visible");
        icon.classList.add("bi-eye-slash");
      }
    }

    function toSentenceCase(value) {
      if (!value) return "";
      return value.charAt(0).toUpperCase() + value.slice(1).toLowerCase();
    }

    document.addEventListener('DOMContentLoaded', function() {
      var fn = document.getElementById("first_name");
      var ln = document.getElementById("last_name");
      if (fn) fn.addEventListener("input", function () { this.value = toSentenceCase(this.value); });
      if (ln) ln.addEventListener("input", function () { this.value = toSentenceCase(this.value); });

      // Adjust content padding to account for footer height
      function adjustContentPadding() {
        var footer = document.querySelector('footer');
        var content = document.querySelector('.content');
        if (!footer || !content) return;
        var extra = 24;
        var footerHeight = footer.offsetHeight || 0;
        content.style.paddingBottom = (footerHeight + extra) + 'px';
      }
      adjustContentPadding();
      var resizeTimer;
      window.addEventListener('resize', function() { clearTimeout(resizeTimer); resizeTimer = setTimeout(adjustContentPadding, 120); });
      try {
        var footerEl = document.querySelector('footer');
        if (window.ResizeObserver && footerEl) {
          var ro = new ResizeObserver(function() { adjustContentPadding(); });
          ro.observe(footerEl);
        }
      } catch (e) {}
    });
  </script>
</body>
</html>